import{useApi as e,defineModule as a}from"@directus/extensions-sdk";import{defineComponent as n,ref as t,onMounted as r,resolveComponent as o,openBlock as l,createBlock as i,withCtx as d,createVNode as s,createTextVNode as c,watch as u,createElementBlock as m,Fragment as p,createCommentVNode as v,createElementVNode as f,renderList as g,toDisplayString as b,normalizeStyle as h,computed as y,unref as _}from"vue";var x=n({__name:"module",setup(a){const n=e(),u=t(null),m=t([]);return r(async()=>{try{const e=await n.get("/items/companies",{params:{filter:{status:{_eq:"active"}},fields:["id","nome_fantasia","slug"],sort:["nome_fantasia"]}});m.value=e.data.data,m.value.length>0&&(u.value=m.value[0].id)}catch(e){console.error("Erro ao carregar empresas:",e)}}),(e,a)=>{const n=o("v-breadcrumb"),t=o("v-icon"),r=o("v-button"),p=o("v-select"),v=o("v-list-item-icon"),f=o("v-list-item-content"),g=o("v-list-item"),b=o("v-list"),h=o("router-view"),y=o("private-view");return l(),i(y,{title:"CRM"},{headline:d(()=>[s(n,{items:[{name:"CRM Imobiliário",to:"/imobi-crm"}]})]),"title-outer:prepend":d(()=>[s(r,{class:"header-icon",rounded:"",icon:"",secondary:"",disabled:""},{default:d(()=>[s(t,{name:"business"})]),_:1})]),actions:d(()=>[s(p,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),items:m.value,"item-text":"nome_fantasia","item-value":"id",placeholder:"Selecione a empresa",class:"company-selector"},{prepend:d(()=>[s(t,{name:"business",small:""})]),_:1},8,["modelValue","items"])]),navigation:d(()=>[s(b,{nav:""},{default:d(()=>[s(g,{to:"/imobi-crm/dashboard"},{default:d(()=>[s(v,null,{default:d(()=>[s(t,{name:"dashboard"})]),_:1}),s(f,null,{default:d(()=>[...a[1]||(a[1]=[c("Dashboard",-1)])]),_:1})]),_:1}),s(g,{to:"/imobi-crm/conversas"},{default:d(()=>[s(v,null,{default:d(()=>[s(t,{name:"chat"})]),_:1}),s(f,null,{default:d(()=>[...a[2]||(a[2]=[c("Conversas WhatsApp",-1)])]),_:1})]),_:1}),s(g,{to:"/imobi-crm/leads"},{default:d(()=>[s(v,null,{default:d(()=>[s(t,{name:"people"})]),_:1}),s(f,null,{default:d(()=>[...a[3]||(a[3]=[c("Leads (Kanban)",-1)])]),_:1})]),_:1}),s(g,{to:"/imobi-crm/imoveis"},{default:d(()=>[s(v,null,{default:d(()=>[s(t,{name:"home"})]),_:1}),s(f,null,{default:d(()=>[...a[4]||(a[4]=[c("Imóveis",-1)])]),_:1})]),_:1})]),_:1})]),default:d(()=>[s(h,{"company-id":u.value},null,8,["company-id"])]),_:1})}}}),k=[],w=[];function I(e,a){if(e&&"undefined"!=typeof document){var n,t=!0===a.prepend?"prepend":"append",r=!0===a.singleTag,o="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(r){var l=k.indexOf(o);-1===l&&(l=k.push(o)-1,w[l]={}),n=w[l]&&w[l][t]?w[l][t]:w[l][t]=i()}else n=i();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function i(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var n=Object.keys(a.attributes),r=0;r<n.length;r++)e.setAttribute(n[r],a.attributes[n[r]]);var l="prepend"===t?"afterbegin":"beforeend";return o.insertAdjacentElement(l,e),e}}I("\n.company-selector[data-v-1f1e933c] {\r\n  min-width: 250px;\n}\n.header-icon[data-v-1f1e933c] {\r\n  --v-button-width: 60px;\r\n  --v-button-height: 60px;\r\n  --v-button-font-size: 32px;\r\n  --v-button-background-color: var(--theme--primary-background);\r\n  --v-button-color: var(--theme--primary);\r\n  --v-button-background-color-hover: var(--theme--primary-subdued);\r\n  --v-button-color-hover: var(--theme--primary);\n}\r\n",{});var N=(e,a)=>{const n=e.__vccOpts||e;for(const[e,t]of a)n[e]=t;return n},C=N(x,[["__scopeId","data-v-1f1e933c"],["__file","module.vue"]]);const S={class:"dashboard"},V={class:"stats-grid"},A={class:"content-grid"},$={class:"funnel-section"},q={key:0,class:"empty-state"},E={key:1,class:"stages"},R={class:"stage-label"},z={class:"stage-bar"},B={class:"stage-count"},F={class:"activities-section"},L={class:"empty-state"};var j=n({__name:"dashboard",props:{companyId:{}},setup(a){const n=a,r=e(),y=t({leads:0,properties:0,conversas:0}),_=t([]),x={novo:"Novo",contato:"Contato",qualificado:"Qualificado",proposta:"Proposta",negociacao:"Negociação",fechado:"Fechado",perdido:"Perdido"};function k(e){return x[e]||e}function w(e){if(0===_.value.length)return 0;return e/Math.max(..._.value.map(e=>e.count))*100}return u(()=>n.companyId,async function(){var e,a,t;if(n.companyId)try{const[o,l,i,d]=await Promise.all([r.get("/items/leads",{params:{filter:{company_id:{_eq:n.companyId}},aggregate:{count:"*"}}}),r.get("/items/properties",{params:{filter:{company_id:{_eq:n.companyId}},aggregate:{count:"*"}}}),r.get("/items/conversas",{params:{filter:{company_id:{_eq:n.companyId},archived:{_neq:!0}},aggregate:{count:"*"}}}),r.get("/items/leads",{params:{filter:{company_id:{_eq:n.companyId}},groupBy:["stage"],aggregate:{count:"*"}}})]);y.value={leads:(null==(e=o.data.data[0])?void 0:e.count)||0,properties:(null==(a=l.data.data[0])?void 0:a.count)||0,conversas:(null==(t=i.data.data[0])?void 0:t.count)||0},_.value=d.data.data||[]}catch(e){console.error("Erro ao carregar estatísticas:",e)}},{immediate:!0}),(e,n)=>{const t=o("v-info"),r=o("v-icon"),u=o("v-card-title"),x=o("v-card-text"),I=o("v-card");return l(),m("div",S,[a.companyId?(l(),m(p,{key:1},[v(" Estatísticas "),f("div",V,[s(t,{icon:"people",title:"Leads",value:y.value.leads.toString(),color:"blue"},null,8,["value"]),s(t,{icon:"home",title:"Imóveis",value:y.value.properties.toString(),color:"green"},null,8,["value"]),s(t,{icon:"chat",title:"Conversas",value:y.value.conversas.toString(),color:"purple"},null,8,["value"]),s(t,{icon:"attach_money",title:"Vendas",value:"--",color:"orange"})]),v(" Funil de Vendas "),f("div",A,[f("div",$,[s(I,null,{default:d(()=>[s(u,null,{default:d(()=>[s(r,{name:"funnel",left:""}),n[1]||(n[1]=c(" Funil de Vendas ",-1))]),_:1}),s(x,null,{default:d(()=>[0===_.value.length?(l(),m("div",q,[s(r,{name:"inbox",large:""}),n[2]||(n[2]=f("p",null,"Nenhum lead cadastrado ainda",-1))])):(l(),m("div",E,[(l(!0),m(p,null,g(_.value,e=>(l(),m("div",{key:e.stage,class:"stage-item"},[f("div",R,b(k(e.stage)),1),f("div",z,[f("div",{class:"stage-fill",style:h({width:w(e.count)+"%"})},null,4),f("span",B,b(e.count),1)])]))),128))]))]),_:1})]),_:1})]),v(" Atividades Recentes "),f("div",F,[s(I,null,{default:d(()=>[s(u,null,{default:d(()=>[s(r,{name:"history",left:""}),n[3]||(n[3]=c(" Atividades Recentes ",-1))]),_:1}),s(x,null,{default:d(()=>[f("div",L,[s(r,{name:"event_note",large:""}),n[4]||(n[4]=f("p",null,"Em desenvolvimento",-1))])]),_:1})]),_:1})])])],64)):(l(),i(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[0]||(n[0]=[c(" Selecione uma empresa no menu superior para visualizar o dashboard. ",-1)])]),_:1}))])}}});I("\n.dashboard[data-v-11f0580c] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\n.stats-grid[data-v-11f0580c] {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n  gap: 16px;\r\n  margin-bottom: 24px;\n}\n.content-grid[data-v-11f0580c] {\r\n  display: grid;\r\n  grid-template-columns: 2fr 1fr;\r\n  gap: 24px;\n}\n.stages[data-v-11f0580c] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\n}\n.stage-item[data-v-11f0580c] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\n}\n.stage-label[data-v-11f0580c] {\r\n  min-width: 120px;\r\n  font-weight: 500;\n}\n.stage-bar[data-v-11f0580c] {\r\n  flex: 1;\r\n  height: 32px;\r\n  background: var(--theme--background-subdued);\r\n  border-radius: var(--theme--border-radius);\r\n  position: relative;\r\n  overflow: hidden;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 12px;\n}\n.stage-fill[data-v-11f0580c] {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  height: 100%;\r\n  background: var(--theme--primary);\r\n  transition: width 0.3s ease;\r\n  opacity: 0.2;\n}\n.stage-count[data-v-11f0580c] {\r\n  position: relative;\r\n  z-index: 1;\r\n  font-weight: 600;\n}\n.empty-state[data-v-11f0580c] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 40px;\r\n  color: var(--theme--foreground-subdued);\r\n  text-align: center;\n}\n.empty-state .v-icon[data-v-11f0580c] {\r\n  margin-bottom: 12px;\r\n  opacity: 0.5;\n}\n@media (max-width: 768px) {\n.content-grid[data-v-11f0580c] {\r\n    grid-template-columns: 1fr;\n}\n}\r\n",{});var T=N(j,[["__scopeId","data-v-11f0580c"],["__file","dashboard.vue"]]);const D={class:"conversas"},M={key:1,class:"chat-container"};var O=n({__name:"conversas",props:{companyId:{}},setup:e=>(a,n)=>{const t=o("v-info");return l(),m("div",D,[e.companyId?(l(),m("div",M,[s(t,{icon:"chat",title:"Conversas WhatsApp",type:"info"},{default:d(()=>[...n[1]||(n[1]=[c(" Interface de chat WhatsApp em desenvolvimento ",-1)])]),_:1})])):(l(),i(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[0]||(n[0]=[c(" Selecione uma empresa no menu superior. ",-1)])]),_:1}))])}});I("\n.conversas[data-v-cbdfd4fe] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\r\n",{});var P=N(O,[["__scopeId","data-v-cbdfd4fe"],["__file","conversas.vue"]]);const U={class:"leads"},Q={class:"toolbar"},W={class:"stats-grid"},G={key:2,class:"board"},K={class:"column-header"},H={class:"column-title"},J={class:"column-body"},X={key:0,class:"empty-card"},Y={class:"lead-header"},Z={class:"muted"},ee={class:"lead-info"},ae={class:"info-row"},ne={class:"info-row"},te={key:0,class:"info-row"},re={class:"lead-actions"},oe={class:"action-buttons"};var le=n({__name:"leads",props:{companyId:{}},setup(a){const n=a,r=e(),x=t([]),k=t(!1),w=t(""),I=t(""),N=t(null),C=[{id:"new",label:"Novo",short:"N",badge:"#2563eb"},{id:"contacted",label:"Contatado",short:"C",badge:"#7c3aed"},{id:"qualified",label:"Qualificado",short:"Q",badge:"#c2410c"},{id:"visit_scheduled",label:"Visita",short:"V",badge:"#ea580c"},{id:"negotiating",label:"Negociando",short:"Neg",badge:"#0ea5e9"},{id:"won",label:"Fechado",short:"F",badge:"#16a34a"},{id:"lost",label:"Perdido",short:"P",badge:"#6b7280"}],S=C.map(e=>({label:e.label,value:e.id})),V=y(()=>{if(!I.value)return x.value;const e=I.value.toLowerCase();return x.value.filter(a=>[a.name,a.email,a.phone].filter(Boolean).some(a=>a.toLowerCase().includes(e)))}),A=y(()=>[{label:"Total",icon:"people",value:x.value.length},{label:"Novos",icon:"bolt",value:$("new").length},{label:"Em contato",icon:"chat",value:$("contacted").length},{label:"Fechados",icon:"check_circle",value:$("won").length}]);function $(e){return V.value.filter(a=>a.stage===e)}function q(e){if(!e)return"—";return{buy:"Compra",rent:"Aluguel"}[e]||e}function E(e){const a=e.replace(/\D/g,"");return 11===a.length?`(${a.slice(0,2)}) ${a.slice(2,7)}-${a.slice(7)}`:10===a.length?`(${a.slice(0,2)}) ${a.slice(2,6)}-${a.slice(6)}`:e||"Sem telefone"}function R(e,a){if(!e&&!a)return"Sem orçamento";const n=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});return e&&a?`${n.format(e)} - ${n.format(a)}`:n.format(e||a||0)}function z(e){if(!e)return;const a=e.replace(/\D/g,"");if(!a)return;return`https://wa.me/${a}?text=${encodeURIComponent("Olá! Recebemos seu contato pelo site iMOBI.")}`}async function B(){if(n.companyId){k.value=!0,w.value="";try{const e=await r.get("/items/leads",{params:{filter:{company_id:{_eq:n.companyId}},sort:["-created_at"],fields:["id","name","email","phone","interest_type","budget_min","budget_max","stage","created_at"]}});x.value=e.data.data||[]}catch(e){console.error("Erro ao carregar leads:",e),w.value="Não foi possível carregar os leads. Tente novamente."}finally{k.value=!1}}}return u(()=>n.companyId,e=>{e?B():x.value=[]},{immediate:!0}),(e,n)=>{const t=o("v-info"),u=o("v-input"),y=o("v-button"),V=o("v-icon"),F=o("v-card-title"),L=o("v-card-text"),j=o("v-card"),T=o("v-alert"),D=o("v-progress-linear"),M=o("v-chip"),O=o("v-select"),P=o("router-link");return l(),m("div",U,[a.companyId?(l(),m(p,{key:1},[f("div",Q,[s(u,{modelValue:I.value,"onUpdate:modelValue":n[0]||(n[0]=e=>I.value=e),placeholder:"Buscar por nome, email ou telefone","icon-left":"search",disabled:k.value},null,8,["modelValue","disabled"]),s(y,{icon:"refresh",loading:k.value,onClick:B},{default:d(()=>[...n[2]||(n[2]=[c("Atualizar",-1)])]),_:1},8,["loading"])]),f("div",W,[(l(!0),m(p,null,g(A.value,e=>(l(),i(j,{key:e.label},{default:d(()=>[s(F,null,{default:d(()=>[s(V,{name:e.icon,left:""},null,8,["name"]),c(" "+b(e.label),1)]),_:2},1024),s(L,{class:"stat-value"},{default:d(()=>[c(b(e.value),1)]),_:2},1024)]),_:2},1024))),128))]),w.value?(l(),i(T,{key:0,type:"danger",icon:"error",class:"mb-4"},{default:d(()=>[c(b(w.value),1)]),_:1})):v("v-if",!0),k.value?(l(),i(D,{key:1,indeterminate:"",class:"mb-4"})):(l(),m("div",G,[(l(),m(p,null,g(C,e=>f("div",{key:e.id,class:"column"},[f("div",K,[f("div",null,[f("p",H,b(e.label),1),f("small",null,b($(e.id).length)+" lead(s)",1)]),s(M,{small:"",style:h({background:e.badge,color:"#fff"})},{default:d(()=>[c(b(e.short),1)]),_:2},1032,["style"])]),f("div",J,[0===$(e.id).length?(l(),m("div",X,[s(V,{name:"inbox",class:"mb-2"}),n[3]||(n[3]=f("p",null,"Nenhum lead neste estágio",-1))])):v("v-if",!0),(l(!0),m(p,null,g($(e.id),a=>(l(),i(j,{key:a.id,class:"lead-card"},{default:d(()=>{return[f("div",Y,[f("div",null,[f("strong",null,b(a.name||"Sem nome"),1),f("p",Z,b((t=a.created_at,new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}))),1)]),f("span",{class:"interest",style:h({background:e.badge})},b(q(a.interest_type)),5)]),f("div",ee,[f("div",ae,[s(V,{name:"mail",small:""}),f("span",null,b(a.email||"Sem email"),1)]),f("div",ne,[s(V,{name:"phone",small:""}),f("span",null,b(E(a.phone||"")),1)]),a.budget_min||a.budget_max?(l(),m("div",te,[s(V,{name:"attach_money",small:""}),f("span",null,b(R(a.budget_min,a.budget_max)),1)])):v("v-if",!0)]),f("div",re,[s(O,{"model-value":a.stage,items:_(S),disabled:N.value===a.id,placeholder:"Alterar estágio","onUpdate:modelValue":e=>async function(e,a){if(!N.value){N.value=e;try{await r.patch(`/items/leads/${e}`,{stage:a});const n=x.value.find(a=>a.id===e);n&&(n.stage=a)}catch(e){console.error("Erro ao atualizar estágio:",e),w.value="Não foi possível alterar o estágio do lead."}finally{N.value=null}}}(a.id,e)},null,8,["model-value","items","disabled","onUpdate:modelValue"]),f("div",oe,[s(y,{icon:"whatsapp",title:"Conversar com "+(a.name||"lead"),href:z(a.phone),target:"_blank",rel:"noopener",secondary:""},null,8,["title","href"]),s(P,{to:`/content/leads/${a.id}`,class:"details-link"},{default:d(()=>[...n[4]||(n[4]=[c("Ver registro",-1)])]),_:1},8,["to"])])])];var t}),_:2},1024))),128))])])),64))]))],64)):(l(),i(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[1]||(n[1]=[c(" Selecione uma empresa no menu superior. ",-1)])]),_:1}))])}}});I("\n.leads[data-v-2633fe5a] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\n.toolbar[data-v-2633fe5a] {\r\n  display: flex;\r\n  gap: 12px;\r\n  align-items: center;\r\n  margin-bottom: 20px;\n}\n.stats-grid[data-v-2633fe5a] {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\r\n  gap: 16px;\r\n  margin-bottom: 24px;\n}\n.stat-value[data-v-2633fe5a] {\r\n  font-size: 2rem;\r\n  font-weight: 700;\n}\n.board[data-v-2633fe5a] {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));\r\n  gap: 16px;\n}\n.column[data-v-2633fe5a] {\r\n  background: var(--theme--background-subdued);\r\n  border-radius: var(--theme--border-radius);\r\n  padding: 16px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\n}\n.column-header[data-v-2633fe5a] {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\n}\n.column-title[data-v-2633fe5a] {\r\n  font-weight: 600;\r\n  margin-bottom: 2px;\n}\n.column-body[data-v-2633fe5a] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\n}\n.empty-card[data-v-2633fe5a] {\r\n  background: var(--theme--background);\r\n  border: 1px dashed var(--theme--border-color-subdued);\r\n  border-radius: var(--theme--border-radius);\r\n  padding: 20px;\r\n  text-align: center;\r\n  color: var(--theme--foreground-subdued);\n}\n.lead-card[data-v-2633fe5a] {\r\n  background: var(--theme--background);\n}\n.lead-header[data-v-2633fe5a] {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  gap: 12px;\n}\n.muted[data-v-2633fe5a] {\r\n  color: var(--theme--foreground-subdued);\r\n  font-size: 0.85rem;\n}\n.interest[data-v-2633fe5a] {\r\n  padding: 4px 8px;\r\n  border-radius: 999px;\r\n  color: #fff;\r\n  font-size: 0.75rem;\r\n  font-weight: 600;\n}\n.lead-info[data-v-2633fe5a] {\r\n  margin: 12px 0;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 6px;\n}\n.info-row[data-v-2633fe5a] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 6px;\r\n  font-size: 0.9rem;\n}\n.lead-actions[data-v-2633fe5a] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\n}\n.action-buttons[data-v-2633fe5a] {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  gap: 12px;\n}\n.details-link[data-v-2633fe5a] {\r\n  font-weight: 600;\r\n  color: var(--theme--primary);\n}\n@media (max-width: 768px) {\n.toolbar[data-v-2633fe5a] {\r\n    flex-direction: column;\r\n    align-items: stretch;\n}\n.action-buttons[data-v-2633fe5a] {\r\n    flex-direction: column;\r\n    align-items: stretch;\n}\n}\r\n",{});var ie=N(le,[["__scopeId","data-v-2633fe5a"],["__file","leads.vue"]]);const de={class:"imoveis"},se={key:1,class:"properties-container"};var ce=n({__name:"imoveis",props:{companyId:{}},setup:e=>(a,n)=>{const t=o("v-info");return l(),m("div",de,[e.companyId?(l(),m("div",se,[s(t,{icon:"home",title:"Gerenciamento de Imóveis",type:"info"},{default:d(()=>[...n[1]||(n[1]=[c(" Listagem e edição de imóveis em desenvolvimento ",-1)])]),_:1})])):(l(),i(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[0]||(n[0]=[c(" Selecione uma empresa no menu superior. ",-1)])]),_:1}))])}});I("\n.imoveis[data-v-ad6ee023] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\r\n",{});var ue=a({id:"imobi-crm",name:"CRM",icon:"business",routes:[{name:"imobi-crm",path:"",component:C,children:[{name:"imobi-crm-dashboard",path:"dashboard",component:T},{name:"imobi-crm-conversas",path:"conversas",component:P},{name:"imobi-crm-leads",path:"leads",component:ie},{name:"imobi-crm-imoveis",path:"imoveis",component:N(ce,[["__scopeId","data-v-ad6ee023"],["__file","imoveis.vue"]])}]}]});export{ue as default};
