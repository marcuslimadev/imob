import{useApi as e,defineModule as a}from"@directus/extensions-sdk";import{defineComponent as n,ref as t,onMounted as o,resolveComponent as r,openBlock as i,createBlock as s,withCtx as d,createVNode as l,createTextVNode as c,watch as u,createElementBlock as m,Fragment as p,createCommentVNode as v,createElementVNode as f,renderList as g,toDisplayString as b,normalizeStyle as h}from"vue";var _=n({__name:"module",setup(a){const n=e(),u=t(null),m=t([]);return o(async()=>{try{const e=await n.get("/items/companies",{params:{filter:{status:{_eq:"active"}},fields:["id","nome_fantasia","slug"],sort:["nome_fantasia"]}});m.value=e.data.data,m.value.length>0&&(u.value=m.value[0].id)}catch(e){console.error("Erro ao carregar empresas:",e)}}),(e,a)=>{const n=r("v-breadcrumb"),t=r("v-icon"),o=r("v-button"),p=r("v-select"),v=r("v-list-item-icon"),f=r("v-list-item-content"),g=r("v-list-item"),b=r("v-list"),h=r("router-view"),_=r("private-view");return i(),s(_,{title:"CRM"},{headline:d(()=>[l(n,{items:[{name:"CRM Imobiliário",to:"/imobi-crm"}]})]),"title-outer:prepend":d(()=>[l(o,{class:"header-icon",rounded:"",icon:"",secondary:"",disabled:""},{default:d(()=>[l(t,{name:"business"})]),_:1})]),actions:d(()=>[l(p,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),items:m.value,"item-text":"nome_fantasia","item-value":"id",placeholder:"Selecione a empresa",class:"company-selector"},{prepend:d(()=>[l(t,{name:"business",small:""})]),_:1},8,["modelValue","items"])]),navigation:d(()=>[l(b,{nav:""},{default:d(()=>[l(g,{to:"/imobi-crm/dashboard"},{default:d(()=>[l(v,null,{default:d(()=>[l(t,{name:"dashboard"})]),_:1}),l(f,null,{default:d(()=>[...a[1]||(a[1]=[c("Dashboard",-1)])]),_:1})]),_:1}),l(g,{to:"/imobi-crm/conversas"},{default:d(()=>[l(v,null,{default:d(()=>[l(t,{name:"chat"})]),_:1}),l(f,null,{default:d(()=>[...a[2]||(a[2]=[c("Conversas WhatsApp",-1)])]),_:1})]),_:1}),l(g,{to:"/imobi-crm/leads"},{default:d(()=>[l(v,null,{default:d(()=>[l(t,{name:"people"})]),_:1}),l(f,null,{default:d(()=>[...a[3]||(a[3]=[c("Leads (Kanban)",-1)])]),_:1})]),_:1}),l(g,{to:"/imobi-crm/imoveis"},{default:d(()=>[l(v,null,{default:d(()=>[l(t,{name:"home"})]),_:1}),l(f,null,{default:d(()=>[...a[4]||(a[4]=[c("Imóveis",-1)])]),_:1})]),_:1})]),_:1})]),default:d(()=>[l(h,{"company-id":u.value},null,8,["company-id"])]),_:1})}}}),y=[],x=[];function I(e,a){if(e&&"undefined"!=typeof document){var n,t=!0===a.prepend?"prepend":"append",o=!0===a.singleTag,r="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(o){var i=y.indexOf(r);-1===i&&(i=y.push(r)-1,x[i]={}),n=x[i]&&x[i][t]?x[i][t]:x[i][t]=s()}else n=s();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function s(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var n=Object.keys(a.attributes),o=0;o<n.length;o++)e.setAttribute(n[o],a.attributes[n[o]]);var i="prepend"===t?"afterbegin":"beforeend";return r.insertAdjacentElement(i,e),e}}I("\n.company-selector[data-v-1f1e933c] {\r\n  min-width: 250px;\n}\n.header-icon[data-v-1f1e933c] {\r\n  --v-button-width: 60px;\r\n  --v-button-height: 60px;\r\n  --v-button-font-size: 32px;\r\n  --v-button-background-color: var(--theme--primary-background);\r\n  --v-button-color: var(--theme--primary);\r\n  --v-button-background-color-hover: var(--theme--primary-subdued);\r\n  --v-button-color-hover: var(--theme--primary);\n}\r\n",{});var k=(e,a)=>{const n=e.__vccOpts||e;for(const[e,t]of a)n[e]=t;return n},w=k(_,[["__scopeId","data-v-1f1e933c"],["__file","module.vue"]]);const S={class:"dashboard"},A={class:"stats-grid"},C={class:"content-grid"},N={class:"funnel-section"},q={key:0,class:"empty-state"},E={key:1,class:"stages"},V={class:"stage-label"},R={class:"stage-bar"},L={class:"stage-count"},M={class:"activities-section"},T={class:"empty-state"};var j=n({__name:"dashboard",props:{companyId:{}},setup(a){const n=a,o=e(),_=t({leads:0,properties:0,conversas:0}),y=t([]),x={novo:"Novo",contato:"Contato",qualificado:"Qualificado",proposta:"Proposta",negociacao:"Negociação",fechado:"Fechado",perdido:"Perdido"};function I(e){return x[e]||e}function k(e){if(0===y.value.length)return 0;return e/Math.max(...y.value.map(e=>e.count))*100}return u(()=>n.companyId,async function(){var e,a,t;if(n.companyId)try{const[r,i,s,d]=await Promise.all([o.get("/items/leads",{params:{filter:{company_id:{_eq:n.companyId}},aggregate:{count:"*"}}}),o.get("/items/properties",{params:{filter:{company_id:{_eq:n.companyId}},aggregate:{count:"*"}}}),o.get("/items/conversas",{params:{filter:{company_id:{_eq:n.companyId},archived:{_neq:!0}},aggregate:{count:"*"}}}),o.get("/items/leads",{params:{filter:{company_id:{_eq:n.companyId}},groupBy:["stage"],aggregate:{count:"*"}}})]);_.value={leads:(null==(e=r.data.data[0])?void 0:e.count)||0,properties:(null==(a=i.data.data[0])?void 0:a.count)||0,conversas:(null==(t=s.data.data[0])?void 0:t.count)||0},y.value=d.data.data||[]}catch(e){console.error("Erro ao carregar estatísticas:",e)}},{immediate:!0}),(e,n)=>{const t=r("v-info"),o=r("v-icon"),u=r("v-card-title"),x=r("v-card-text"),w=r("v-card");return i(),m("div",S,[a.companyId?(i(),m(p,{key:1},[v(" Estatísticas "),f("div",A,[l(t,{icon:"people",title:"Leads",value:_.value.leads.toString(),color:"blue"},null,8,["value"]),l(t,{icon:"home",title:"Imóveis",value:_.value.properties.toString(),color:"green"},null,8,["value"]),l(t,{icon:"chat",title:"Conversas",value:_.value.conversas.toString(),color:"purple"},null,8,["value"]),l(t,{icon:"attach_money",title:"Vendas",value:"--",color:"orange"})]),v(" Funil de Vendas "),f("div",C,[f("div",N,[l(w,null,{default:d(()=>[l(u,null,{default:d(()=>[l(o,{name:"funnel",left:""}),n[1]||(n[1]=c(" Funil de Vendas ",-1))]),_:1}),l(x,null,{default:d(()=>[0===y.value.length?(i(),m("div",q,[l(o,{name:"inbox",large:""}),n[2]||(n[2]=f("p",null,"Nenhum lead cadastrado ainda",-1))])):(i(),m("div",E,[(i(!0),m(p,null,g(y.value,e=>(i(),m("div",{key:e.stage,class:"stage-item"},[f("div",V,b(I(e.stage)),1),f("div",R,[f("div",{class:"stage-fill",style:h({width:k(e.count)+"%"})},null,4),f("span",L,b(e.count),1)])]))),128))]))]),_:1})]),_:1})]),v(" Atividades Recentes "),f("div",M,[l(w,null,{default:d(()=>[l(u,null,{default:d(()=>[l(o,{name:"history",left:""}),n[3]||(n[3]=c(" Atividades Recentes ",-1))]),_:1}),l(x,null,{default:d(()=>[f("div",T,[l(o,{name:"event_note",large:""}),n[4]||(n[4]=f("p",null,"Em desenvolvimento",-1))])]),_:1})]),_:1})])])],64)):(i(),s(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[0]||(n[0]=[c(" Selecione uma empresa no menu superior para visualizar o dashboard. ",-1)])]),_:1}))])}}});I("\n.dashboard[data-v-11f0580c] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\n.stats-grid[data-v-11f0580c] {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n  gap: 16px;\r\n  margin-bottom: 24px;\n}\n.content-grid[data-v-11f0580c] {\r\n  display: grid;\r\n  grid-template-columns: 2fr 1fr;\r\n  gap: 24px;\n}\n.stages[data-v-11f0580c] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12px;\n}\n.stage-item[data-v-11f0580c] {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\n}\n.stage-label[data-v-11f0580c] {\r\n  min-width: 120px;\r\n  font-weight: 500;\n}\n.stage-bar[data-v-11f0580c] {\r\n  flex: 1;\r\n  height: 32px;\r\n  background: var(--theme--background-subdued);\r\n  border-radius: var(--theme--border-radius);\r\n  position: relative;\r\n  overflow: hidden;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 12px;\n}\n.stage-fill[data-v-11f0580c] {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  height: 100%;\r\n  background: var(--theme--primary);\r\n  transition: width 0.3s ease;\r\n  opacity: 0.2;\n}\n.stage-count[data-v-11f0580c] {\r\n  position: relative;\r\n  z-index: 1;\r\n  font-weight: 600;\n}\n.empty-state[data-v-11f0580c] {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 40px;\r\n  color: var(--theme--foreground-subdued);\r\n  text-align: center;\n}\n.empty-state .v-icon[data-v-11f0580c] {\r\n  margin-bottom: 12px;\r\n  opacity: 0.5;\n}\n@media (max-width: 768px) {\n.content-grid[data-v-11f0580c] {\r\n    grid-template-columns: 1fr;\n}\n}\r\n",{});var z=k(j,[["__scopeId","data-v-11f0580c"],["__file","dashboard.vue"]]);const F={class:"conversas"},K={key:1,class:"chat-container"};var O=n({__name:"conversas",props:{companyId:{}},setup:e=>(a,n)=>{const t=r("v-info");return i(),m("div",F,[e.companyId?(i(),m("div",K,[l(t,{icon:"chat",title:"Conversas WhatsApp",type:"info"},{default:d(()=>[...n[1]||(n[1]=[c(" Interface de chat WhatsApp em desenvolvimento ",-1)])]),_:1})])):(i(),s(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[0]||(n[0]=[c(" Selecione uma empresa no menu superior. ",-1)])]),_:1}))])}});I("\n.conversas[data-v-cbdfd4fe] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\r\n",{});var P=k(O,[["__scopeId","data-v-cbdfd4fe"],["__file","conversas.vue"]]);const W={class:"leads"},B={key:1,class:"kanban-container"};var Q=n({__name:"leads",props:{companyId:{}},setup:e=>(a,n)=>{const t=r("v-info");return i(),m("div",W,[e.companyId?(i(),m("div",B,[l(t,{icon:"view_kanban",title:"Kanban de Leads",type:"info"},{default:d(()=>[...n[1]||(n[1]=[c(" Quadro Kanban com drag-and-drop em desenvolvimento ",-1)])]),_:1})])):(i(),s(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[0]||(n[0]=[c(" Selecione uma empresa no menu superior. ",-1)])]),_:1}))])}});I("\n.leads[data-v-556730df] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\r\n",{});var D=k(Q,[["__scopeId","data-v-556730df"],["__file","leads.vue"]]);const G={class:"imoveis"},U={key:1,class:"properties-container"};var H=n({__name:"imoveis",props:{companyId:{}},setup:e=>(a,n)=>{const t=r("v-info");return i(),m("div",G,[e.companyId?(i(),m("div",U,[l(t,{icon:"home",title:"Gerenciamento de Imóveis",type:"info"},{default:d(()=>[...n[1]||(n[1]=[c(" Listagem e edição de imóveis em desenvolvimento ",-1)])]),_:1})])):(i(),s(t,{key:0,type:"warning",icon:"business",title:"Nenhuma empresa selecionada"},{default:d(()=>[...n[0]||(n[0]=[c(" Selecione uma empresa no menu superior. ",-1)])]),_:1}))])}});I("\n.imoveis[data-v-ad6ee023] {\r\n  padding: var(--content-padding);\r\n  padding-top: var(--content-padding-bottom);\n}\r\n",{});var J=a({id:"imobi-crm",name:"CRM",icon:"business",routes:[{name:"imobi-crm",path:"",component:w,children:[{name:"imobi-crm-dashboard",path:"dashboard",component:z},{name:"imobi-crm-conversas",path:"conversas",component:P},{name:"imobi-crm-leads",path:"leads",component:D},{name:"imobi-crm-imoveis",path:"imoveis",component:k(H,[["__scopeId","data-v-ad6ee023"],["__file","imoveis.vue"]])}]}]});export{J as default};
